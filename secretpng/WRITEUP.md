# Secret Picture: Write-up

На этой картинке в формате PNG мы видим скриншот описания [стандарта формата PNG](https://www.w3.org/TR/PNG/).

Поиграв со Stegsolve, замечаем небольшую точку около пункта `9 Filtering`. Давайте разберемся, как он работает.

Фильтр — это такой байт, который применяется к каждой строке изображения и может её модифицировать. Бывает пять типов фильтров:

* `0`: строка должна остаться без изменений
* `1`: вместо каждого байта строки записывается его разность с байтом той же компоненты предыдущего пикселя (т.е. вместо `r1g1b1a1r2g2b2a2r3...` пишется `r1g1b1a1(r2-r1)(g2-g1)(b2-b1)(a2-a1)(r3-r2)...`).
* `2`: вместо каждого байта строки записывается его разность с этим же байтом предыдущей строки
* `3`: вместо каждого байта строки записывается его разность со средним арифметическим с байтом «сверху» и соответствующим байтом предыдущего пикселя
* `4`: вместо каждого байта строки записывается его разность со сложной функцией `PaethPredictor` (см. спецификацию)

Вопрос, собственно, в том, зачем это нужно. Ответ на него очень прост: итоговая строка будет сжата алгоритмом DEFLATE, который очень хорошо сжимает одинаковые символы. А такой способ позволяет увеличить число похожих и одинаковых символов, так как в большинстве изображений эти самые разности будут небольшими.

Однако, большинство графических редакторов просто их игнорируют, используя нули для всех строк. В нашей же картинке значение фильтра в каждой строке различается, причем достаточно равномерно используются значения 0–3, причем создается ощущение, что они никак не помогают уменьшить размер изображения.

Можно предположить, что там и спрятан флаг. Для работы с чанком `IDAT` нам понадобится HEX-редактор, чтобы вытащить данные чанка, и Python, чтобы распаковать DEFLATE. Давайте  проверим нашу задумку [небольшим скриптом](private/solution.py). И правда, флаг записан в четверичной системе счисления в параметре фильтра.

Флаг: **ugractfeveryonelikespngfilters**
